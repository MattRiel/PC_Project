<!DOCTYPE html>
<html lang="en" class="h-101">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PC - PROJECT AKHIR</title>
    <!-- BootStrap Link -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"
    ></script>
    <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link href="styles.css" rel="stylesheet" />
    <!-- BootStrap Link -->
  </head>

  <body class="d-flex h-100 text-center text-bg-dark">
    <header>
      <nav class="navbar fixed-top" style="background-color: yellow">
        <div class="container-fluid">
          <a class="navbar-brand"> KELOMPOK 1 </a>
          <a class="navbar-brand centered">PENGOLAHAN CITRA</a>
          <a class="navbar-brand">KOM A - 2022</a>
        </div>
      </nav>
    </header>

    <main>
      <div class="split left">
        <div class="position-absolute top-50 start-50 translate-middle">
          <div class="col">
            <h4>RGB TOOLS</h4>
            <button id="read">Read</button>
            <button id="ori">Original</button>
          </div>
          <hr />
          <div class="col">
            <h4>IMAGE PROCESSING 1</h4>
            <button id="negatif" type="button">Negative</button>
            <button id="grayscl" type="button">Grayscale</button>
            <br />
            <!-- Threshold -->
            Threshold
            <input type="range" min="0" max="255" id="threshold" value="0" />
            <input type="text" size="3" disabled value="0" id="threshold_val" />
            <button id="thdefault" class="btn btn-danger btn-sm">Reset</button>
            <br />
            <!-- Threshold -->
            <!-- Brightness -->
            Brightness
            <input
              type="range"
              min="-255"
              max="255"
              data-id="4"
              id="brightness"
              value="0"
            />
            <input
              type="text"
              id="brightness_val"
              size="3"
              disabled
              value="0"
            />
            <button id="brdefault" class="btn btn-danger btn-sm">Reset</button>
            <!-- Brightness -->
          </div>
          <hr />
          <div class="col">
            <h4>EDGE DETECTION</h4>
            <button id="sobel">Sobel Method</button>
          </div>
        </div>
      </div>

      <div class="split right">
        <!-- Image -->
        <div class="wrapper mt-5">
          <div class="col">
            <h2>Original Image</h2>
            <canvas
              id="canvas3"
              width="180px"
              style="
                border-style: double;
                border-color: cyan;
                border-radius: 20px;
                max-width: 75%;
                height: auto;
              "
            ></canvas>
          </div>
          <div class="col">
            <h2>Result Image</h2>
            <canvas
              id="canvas1"
              width="180px"
              style="
                border-style: double;
                border-color: cyan;
                border-radius: 20px;
                max-width: 75%;
                height: auto;
              "
            ></canvas>
          </div>
          <h6 style="font-family: consolas; color: greenyellow" id="log_out">
            CONSOLE LOG
          </h6>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer fixed-bottom" style="background-color: yellow">
        <div class="container-fluid">
          <div class="row align-items-center" style="color: black">
            <div class="col">201401019</div>
            <div class="col">201401038</div>
            <div class="col">201401040</div>
          </div>
        </div>
      </div>
    </footer>
  </body>

  <!-- JavaScript -->
  <script src="imageproc.js"></script>
  <script>
    var canvas1 = document.getElementById('canvas1');
    var canvas3 = document.getElementById('canvas3');
    var img = 'v1.png';
    var obj1 = new pc(canvas1);
    var prev = new pc(canvas3);
    prev.image2canvas(img);
    obj1.image2canvas(img);
    var tes = new Array();
  </script>

  <!-- Read Citra -->
  <script>
    document.getElementById('read').addEventListener('click', function () {
      tes = obj1.image2read();
      document.getElementById('log_out').innerHTML = 'Citra berhasil dibaca';
    });
  </script>

  <!-- Citra Asli -->
  <script>
    document.getElementById('ori').addEventListener('click', function () {
      obj1.image2original();
      document.getElementById('log_out').innerHTML = 'Citra dipulihkan';
    });
  </script>

  <!-- Threshold -->
  <script>
    // Threshold
    document.getElementById('threshold').addEventListener('click', function () {
      document.getElementById('threshold_val').value = this.value;
      batas = parseInt(this.value);
      // copy array without reference
      tesbackup = new Array();
      for (var c = 0; c < tes.length; c++) {
        temp = new Array();
        for (var d = 0; d < 4; d++) {
          temp.push(tes[c][d]);
        }
        tesbackup.push(temp);
      }

      // end of copy
      for (var i = 0; i < tes.length; i++) {
        gabung = Math.floor(
          (tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2]) / 3
        );
        if (gabung < batas) {
          gabung = 0;
        } else {
          gabung = 255;
        }
        tes[i][0] = gabung;
        tes[i][1] = gabung;
        tes[i][2] = gabung;
        tes[i][3] = tes[i][3];
      }
      obj1.array2canvas(tesbackup);
    });

    // Threshold Default
    document.getElementById('thdefault').addEventListener('click', function () {
      document.getElementById('threshold').value = 0;
      document.getElementById('threshold_val').value = 0;
      rgbachange();
    });
  </script>
  <!-- Threshold -->

  <!-- Brightness -->
  <script>
    // Brightness
    document
      .getElementById('brightness')
      .addEventListener('click', function () {
        document.getElementById('brightness_val').value = this.value;
        p = parseInt(this.value);
        // copy array without reference
        tesbackup = new Array();
        for (var c = 0; c < tes.length; c++) {
          temp = new Array();
          for (var d = 0; d < 4; d++) {
            temp.push(tes[c][d]);
          }
          tesbackup.push(temp);
        }

        // end of copy
        for (var i = 0; i < tes.length; i++) {
          tesbackup[i][0] = tes[i][0] + p;
          tesbackup[i][1] = tes[i][1] + p;
          tesbackup[i][2] = tes[i][2] + p;
          tesbackup[i][3] = tes[i][3];
        }
        obj1.array2canvas(tesbackup);
      });

    // Brightness Default
    document.getElementById('brdefault').addEventListener('click', function () {
      document.getElementById('brightness').value = 0;
      document.getElementById('brightness_val').value = 0;
      rgbachange();
    });
  </script>
  <!-- Brightness -->

  <!-- Negative -->
  <script>
    document.getElementById('negatif').addEventListener('click', function () {
      tesbackup = new Array();
      for (var c = 0; c < tes.length; c++) {
        temp = new Array();
        for (var d = 0; d < 4; d++) {
          temp.push(tes[c][d]);
        }
        tesbackup.push(temp);
      }
      for (var i = 0; i < tesbackup.length; i++) {
        tes[i][0] = 255 - tesbackup[i][0];
        tes[i][1] = 255 - tesbackup[i][1];
        tes[i][2] = 255 - tesbackup[i][2];
        tes[i][3] = tesbackup[i][3];
      }
      obj1.array2canvas(tes);
    });
  </script>
  <!-- Negative -->

  <!-- Grayscale -->
  <script>
    document.getElementById('grayscl').addEventListener('click', function () {
      tesbackup = new Array();
      for (var c = 0; c < tes.length; c++) {
        temp = new Array();
        for (var d = 0; d < 4; d++) {
          temp.push(tes[c][d]);
        }
        tesbackup.push(temp);
      }

      for (var i = 0; i < tesbackup.length; i++) {
        var total = Math.floor(
          (tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2]) / 3
        );
        tes[i][0] = total;
        tes[i][1] = total;
        tes[i][2] = total;
        tes[i][3] = tesbackup[i][3];
      }

      obj1.array2canvas(tes);
    });
  </script>
  <!-- Grayscale -->

  <!-- Sobel Edge Detection -->
  <script>
    document.getElementById('sobel').addEventListener('click', function () {
      var Gxtemp = new Array(4);
      var Gytemp = new Array(4);
      var G = new Array();
      var xpos = 0;
      var ypos = 0;
      function cek(x, y, n) {
        if (y >= 0 && x >= 0 && x < obj1.width && y < obj1.height)
          return parseInt(tes[obj1.xy2i(x, y)]);
        else return 0;
      }
      for (var i = 0; i < tes.length; i++) {
        var Gtemp = new Array(4);
        xpos = obj1.i2x(i);
        ypos = obj1.i2y(i);
        for (var j = 0; j < 3; j++) {
          Gxtemp[j] =
            cek(xpos - 1, ypos - 1) * -1 +
            cek(xpos - 1, ypos) * -2 +
            cek(xpos - 1, ypos + 1) * -1 +
            cek(xpos + 1, ypos - 1) +
            cek(xpos + 1, ypos) * 2 +
            cek(xpos + 1, ypos + 1);

          Gytemp[j] =
            cek(xpos - 1, ypos - 1) * -1 +
            cek(xpos, ypos - 1) * -2 +
            cek(xpos + 1, ypos - 1) * -1 +
            cek(xpos - 1, ypos + 1) +
            cek(xpos, ypos + 1) * 2 +
            cek(xpos + 1, ypos + 1);

          Gtemp[j] = Math.floor(
            Math.sqrt(
              parseInt(Gxtemp[j]) * parseInt(Gxtemp[j]) +
                parseInt(Gytemp[j]) * parseInt(Gytemp[j])
            )
          );
        }
        Gtemp[3] = tes[i][3];
        G.push(Gtemp);
      }
      obj1.array2canvas(G);
    });
  </script>
  <!-- Sobel Edge Detection -->
</html>
